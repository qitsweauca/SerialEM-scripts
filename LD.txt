ScriptName LD
# main macro for single particle data collection in Low Dose Mode
# update @ 2017-12-14  => add modulo function to align ZLP from DM
# after R shot

# define buffer to which ref image is copied temporarily
buffer = T

Echo ===> Running LD ...

## position (X,Y)
RealignToNavItem 1
#CallFunction MyFuncs::ZeroIS-quick 0.3 3.0
#CallFunction MyFuncs::CropImage A 0.25

Copy A $buffer
CallFunction MyFuncs::AlignToBuffer 2 $buffer

## Center Beam, assume AutoCenterBeam policy has been set up
AutoCenterBeam

## CycleTargetFocus, range is set in macro "Parameters".
CallFunction MyFuncs::CycleTargetFocus -1.2 -2.2 0.1 

## Autofocus
G

## Drift control, till 2A/sec, using F shot
CallFunction MyFuncs::Drift 2 F

## shot
#EarlyReturnNextShot 0
R
#S

## Align ZLP every 100 shots
ReportNavItem
remainder = modulo $navAcqIndex 100
If $remainder == 0
   CallFunction AlignZLPFromDM
Endif

ReportClock
echo ----------------------------------------------------------------
