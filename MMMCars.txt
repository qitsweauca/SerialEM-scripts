ScriptName MMMCars
# make all the MMMs from different cartriges automatically!!!
# use property of current registration to do so. 
#
# Assume all the LMM maps are done, each with registration 
# as the cartrige #, all done by script LMMCars. A few meshes
# picked have the same registration value as the LMM has.
#
echo #############################################
echo ###  ClearPersistentvars                 ####
echo #############################################

##########################
# navigator must be open
##########################
echo ---> Running MMMCars!!!

## define where to save, cartirges and sample names
SetDirectory X:\TEST-XC

# read in the cartrige and sample information like LMM
Call Cars

#cat = { 1 2  }
#name = { name1 name2 }

### do it! 
CallFunction MMMCars 

################ No editing Below #################

Function MMMCars 0 0 
## Define persistant variable 
IsVariableDefined regInd
If $repVal1 == 0 
     regInd := 1           
Endif

ReportNavItem 
SetNavRegistration $navRegis
LoadCartridge $navRegis
SetColumnOrGunValve 1


#  C2 100, Obj out
SetupScopeMessage 0 0 C2_100-OBJ_out
ShowMessageOnScope SerialEM!
Delay 2 
RealignToNavItem 1

# from shift to marker got the X, Y shifts 46X  - 1250X
MoveStage 3.2 -11.03

#  C2 70, Obj 70
SetupScopeMessage 0 0 C2_70-OBJ_70
ShowMessageOnScope SerialEM!
Delay 2

# get Z height right
Call Z_byV2-200

### get map and JPG image of it.
OpenNewFile Vmap-Car$cat[$regInd]-$name[$regInd]-mesh$navLabel.st
V
S
NewMap 

# get file root name and Z number
ReportCurrentFilename 1
root = $RepVal1 
ext = $RepVal2
ReportFileZsize
z = $RepVal1

# save to jpeg for lazy people! 
SaveToOtherFile A TIFF JPG $root-$z.jpg
CloseFile 

## if last point of this registration, switch to next available registration
ReportNumNavAcquire 
If $repVal1 == 1  
     regInd := $regInd + 1
      If $regInd > $#cat
         regInd :=                            # clear the persistant variable
         exit
       Else 
           echo SetNavRegistration $cat[$regInd]
           SetNavRegistration $cat[$regInd]
           LoadCartridge $cat[$regInd]
       Endif   
 else 
       echo  +++++  Going to next item in the same Registration! +++++
Endif

EndFunction 

echo
